@if (playlist.length > 0 && show_player) {
  <div style="height: 100%">
    <div style="height: 100%" [ngClass]="(currentItem.type === 'audio/mp3') ? null : 'container-video'">
      <div style="max-width: 100%; margin-left: 0px; height: 100%">
        <mat-drawer-container style="height: 100%" class="example-container" autosize>
          <div style="height: fit-content" [ngClass]="(currentItem.type === 'audio/mp3') ? 'audio-col' : 'video-col'">
            <vg-player style="height: fit-content; max-height: 75vh" (onPlayerReady)="onPlayerReady($event)" [style.background-color]="(currentItem.type === 'audio/mp3') ? postsService.theme.drawer_color : 'black'">
              <video [ngClass]="(currentItem.type === 'audio/mp3') ? 'audio-styles' : 'video-styles'" #media class="video-player" [vgMedia]="$any(media)" [src]="currentItem.src" id="singleVideo" preload="auto" controls playsinline>
              </video>
              @if (postsService['config']['API']['use_sponsorblock_API'] && api && playlist?.length > 0 && playlist[currentIndex]['type'] === 'video/mp4') {
                <app-skip-ad-button (setPlaybackTimestamp)="setPlaybackTimestamp($event)" [current_video]="playlist[currentIndex]" [playback_timestamp]="api.currentTime" class="skip-ad-button"></app-skip-ad-button>
              }
            </vg-player>
          </div>
          <div style="height: fit-content; width: 100%; margin-top: 10px;">
            <div class="container">
              <div class="row">
                <div class="col-2 col-lg-1">
                  @if (db_file) {
                    {{db_file['local_view_count'] ? db_file['local_view_count']+1 : 1}}&nbsp;<ng-container i18n="View count label">views</ng-container>
                  }
                </div>
                <div style="white-space: pre-line;" class="col-8 col-lg-9">
                  @if (db_file && db_file['description']) {
                    <p>
                      <app-see-more [text]="db_file['description']"></app-see-more>
                    </p>
                  } @else {
                    <p i18n="No description" style="text-align: center;">
                      No description available.
                    </p>
                  }
                </div>
                <div class="col-2">
                  @if (db_playlist) {
                    <span class="buttons">
                      <button (click)="downloadContent()" [disabled]="downloading" mat-icon-button><mat-icon>save</mat-icon></button>
                      @if (downloading) {
                        <mat-spinner class="spinner" [diameter]="35"></mat-spinner>
                      }
                      @if ((!postsService.isLoggedIn || postsService.permissions.includes('sharing')) && !auto) {
                        <button (click)="openShareDialog()" mat-icon-button><mat-icon>share</mat-icon></button>
                      }
                    </span>
                  }
                  @if (db_file) {
                    <span class="buttons">
                      <button (click)="downloadFile()" [disabled]="downloading" mat-icon-button><mat-icon>cloud_download</mat-icon></button>
                      @if (downloading) {
                        <mat-spinner class="spinner" [diameter]="35"></mat-spinner>
                      }
                      @if (!postsService.isLoggedIn || postsService.permissions.includes('sharing')) {
                        <button (click)="openShareDialog()" mat-icon-button><mat-icon>share</mat-icon></button>
                      }
                    </span>
                  }
                  @if (db_file || db_playlist) {
                    <button (click)="openFileInfoDialog()" mat-icon-button><mat-icon>info</mat-icon></button>
                  }
                  @if (db_file && db_file.url.includes('twitch.tv')) {
                    <button (click)="drawer.toggle()" mat-icon-button><mat-icon>chat</mat-icon></button>
                  }
                </div>
              </div>
            </div>
          </div>
          <div style="height: fit-content; width: 100%; margin-top: 10px;">
            <mat-button-toggle-group cdkDropList [cdkDropListSortingDisabled]="true" (cdkDropListDropped)="drop($event)" style="width: 80%; left: 9%" vertical name="videoSelect" aria-label="Video Select" #group="matButtonToggleGroup">
              @for (playlist_item of playlist; track playlist_item; let i = $index) {
                <mat-button-toggle cdkDrag [checked]="currentItem.title === playlist_item.title" (click)="onClickPlaylistItem(playlist_item, i)" class="toggle-button" [value]="playlist_item.title">{{playlist_item.label}}</mat-button-toggle>
              }
            </mat-button-toggle-group>
          </div>
          @if (db_file && api && postsService.config) {
            <app-concurrent-stream (setPlaybackRate)="setPlaybackRate($event)" (togglePlayback)="togglePlayback($event)" (setPlaybackTimestamp)="setPlaybackTimestamp($event)" [playing]="api.state === 'playing'" [uid]="uid" [playback_timestamp]="api.time.current/1000" [server_mode]="!postsService.config.Advanced.multi_user_mode || postsService.isLoggedIn"></app-concurrent-stream>
          }
          <mat-drawer #drawer class="example-sidenav" mode="side" position="end" [opened]="db_file && db_file['chat_exists']">
            @if (api_ready && db_file && db_file.url.includes('twitch.tv')) {
              <app-twitch-chat #twitchchat [db_file]="db_file" [current_timestamp]="api.currentTime" [sub]="subscription"></app-twitch-chat>
            }
          </mat-drawer>
        </mat-drawer-container>
      </div>
    </div>
  </div>
}